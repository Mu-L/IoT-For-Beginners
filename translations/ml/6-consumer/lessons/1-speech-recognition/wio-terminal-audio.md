# เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเด - Wio เดเตเตผเดฎเดฟเดจเตฝ

เดชเดพเดเดคเตเดคเดฟเดจเตเดฑเต เด เดญเดพเดเดคเตเดคเดฟเตฝ, เดจเดฟเดเตเดเดณเตเดเต Wio เดเตเตผเดฎเดฟเดจเดฒเดฟเตฝ เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเดพเตป เดเตเดกเต เดเดดเตเดคเตเด. เดเดกเดฟเดฏเต เดเดชเตเดเตผ Wio เดเตเตผเดฎเดฟเดจเดฒเดฟเดจเตเดฑเต เดฎเตเดเดณเดฟเตฝ เดเดณเตเดณ เดฌเดเตเดเดฃเตเดเดณเดฟเตฝ เดเดจเตเดจเต เดเตเดฃเตเดเต เดจเดฟเดฏเดจเตเดคเตเดฐเดฟเดเตเดเตเด.

## เดกเดฟเดตเตเดธเดฟเดจเต เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเดพเตป เดชเตเดฐเตเดเตเดฐเดพเด เดเตเดฏเตเดฏเตเด

C++ เดเตเดกเต เดเดชเดฏเตเดเดฟเดเตเดเต เดฎเตเดเตเดฐเตเดซเตเตบ เดจเดฟเดจเตเดจเต เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเดพเด. Wio เดเตเตผเดฎเดฟเดจเดฒเดฟเดจเต 192KB เดฐเดพเด เดฎเดพเดคเตเดฐเดฎเต เดเดณเตเดณเต, เดเดคเตเดเตเดฃเตเดเต เดฐเดฃเตเดเตเดตเตผเดทเด เดเตเดเตเดคเตฝ เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเดพเตป เดธเดพเดงเดฟเดเตเดเตเดจเตเดจเดฟเดฒเตเดฒ. เดชเดเตเดทเต, 4MB เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดเดณเตเดณเดคเดฟเดจเดพเตฝ, เดเตเดฏเดพเดชเตเดเตผ เดเตเดฏเตเดค เดเดกเดฟเดฏเต เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเตเดเตเดเต เดธเตเดตเต เดเตเดฏเตเดฏเดพเตป เดเดคเตเดชเดฏเตเดเดฟเดเตเดเดพเด.

เดเตปเดฌเดฟเตฝเดฑเตเดฑเต เดฎเตเดเตเดฐเตเดซเตเตบ เดเดจเดฒเตเดเต เดธเดฟเดเตเดจเตฝ เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเดจเตเดจเต, เดเดคเต เดกเดฟเดเดฟเดฑเตเดฑเตฝ เดธเดฟเดเตเดจเดฒเดพเดฏเดฟ เดฎเดพเดฑเตเดฑเตเดเดฏเตเด เดเดคเต Wio เดเตเตผเดฎเดฟเดจเตฝ เดเดชเดฏเตเดเดฟเดเตเดเดพเดจเดพเดเตเดเดฏเตเด เดเตเดฏเตเดฏเตเด. เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเดฎเตเดชเตเตพ, เดกเดพเดฑเตเดฑ เดถเดฐเดฟเดฏเดพเดฏ เดธเดฎเดฏเดคเตเดคเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเดฃเตเดเดคเดพเดฃเต - เดเดฆเดพเดนเดฐเดฃเดคเตเดคเดฟเดจเต 16KHz เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเดพเดจเตเดเตเดเดฟเตฝ, เดเดกเดฟเดฏเต เดฎเดจเดธเตเดธเดฟเดฒเตเดณเตเดณเดคเตเดฒเตเดฒเดพเด ัะตะบัะฝะดเดฟเตฝ 16,000 เดคเดตเดฃเดฏเตเด เดธเดฎเดคเตเดฒเตเดฏ เดเดเดตเตเดณเดเดณเตเดเต เดตเตเดฃเด เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเด. เดจเดฟเดเตเดเดณเตเดเต เดเตเดกเต เดเดคเดฟเดจเต เดชเดเดฐเด, เดกเดฏเดฑเดเตเดเต เดฎเตเดฎเตเดฎเดฑเดฟ เดเดเตเดธเดธเต เดเตบเดเตเดฐเตเดณเตผ (DMAC) เดเดชเดฏเตเดเดฟเดเตเดเดพเด. เดเดคเต เดเดฐเต เดธเตผเดเตเดเตเดฏเตเดเตเดเต เดเดฃเต, เดธเดฟเดเตเดจเตฝ เดเดตเดฟเดเตเดเตเดเดฟเดฒเตเด เดจเดฟเดจเตเดจเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเตฝ เดเดดเตเดคเดพเตป เดเดดเดฟเดฏเตเด, เดชเตเดฐเตเดธเดธเตเดธเดฑเดฟเตฝ เดเตเดกเต เดชเตเดฐเดตเตผเดคเตเดคเดจเด เดคเดเดธเตเดธเดชเตเดชเตเดเตเดคเตเดคเดพเดคเต.

โ [เดตเดฟเดเตเดเดฟเดชเตเดกเดฟเดฏเดฏเดฟเตฝ เดกเดฏเดฑเดเตเดเต เดฎเตเดฎเตเดฎเดฑเดฟ เดเดเตเดธเดธเต เดชเตเดเต](https://wikipedia.org/wiki/Direct_memory_access) เตฝ DMA เดจเตเดฑเต เดธเดจเตเดฆเตผเดถเดจเด เดเตเดเตเดคเตฝ เดตเดพเดฏเดฟเดเตเดเตเด.

![เดฎเตเดเตเดเดฟเตฝ เดจเดฟเดจเตเดจเต เดเดกเดฟเดฏเต ADC เดฏเดฟเดฒเตเดเตเดเตเด เดเดคเต DMAC เดฏเดฟเดฒเตเดเตเดเตเด เดชเตเดเตเดจเตเดจเต. เดเดคเต เดเดฐ_BUF_ เดซเตเดฐเดฑเดฑเดฟเดฒเตเดเตเดเต เดเดดเตเดคเตเดจเตเดจเต. เด BUF_ เดชเตเดฐเตเดฃเตเดฃเดฎเดพเดฏเดพเตฝ, เดเดคเต เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดคเต DMAC เดฐเดฃเตเดเดพเดฎเดคเตเดคเต BUF_ เดฏเดฟเตฝ เดเดดเตเดคเตเด](../../../../../translated_images/ml/dmac-adc-buffers.4509aee49145c90b.webp)

DMAC 16KHz เดเดกเดฟเดฏเตเดฏเตเดเตเดเต เดตเตเดฃเตเดเดฟ 16,000 เดคเดตเดฃ เดธเตเดฅเดฟเดฐเดฎเดพเดฏเดฟ ADC เตฝ เดจเดฟเดจเตเดจเต เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเดพเด. เดเดคเต เดเตเดฏเดพเดชเตเดเตผ เดเตเดฏเตเดค เดกเดพเดฑเตเดฑ เดชเตเดฐเต-เดเดฒเตเดเตเดเตเดฑเตเดฑเต เดเตเดฏเตเดค เดฎเตเดฎเตเดฎเดฑเดฟ เดฌเดซเดฑเดฟเตฝ เดเดดเตเดคเดพเดจเตเด, เดเดคเต เดชเตเดฐเตเดฃเตเดฃเดฎเดพเดฏเดชเตเดชเตเตพ เดจเดฟเดเตเดเดณเตเดเต เดเตเดกเดฟเดจเต เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเดพเตป เดเดจเตเดตเดฆเดฟเดเตเดเดพเดจเตเด เดเดดเดฟเดฏเตเด. เด เดฎเตเดฎเตเดฎเดฑเดฟ เดเดชเดฏเตเดเดฟเดเตเดเตเดจเตเดจเดคเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเดจเตเดจเดคเดฟเตฝ เดเตเดฑเดเตเดเต เดตเตเดเดฟเดชเตเดชเดฟเดเตเดเดพเดฎเตเดเตเดเดฟเดฒเตเด, เดจเดฟเดเตเดเดณเตเดเตเดเต เดฌเดซเดฑเตเดเตพ เดชเดฒเดคเตเด เดธเดเตเดเดฎเดพเดเตเดเดพเด. DMAC เดเดฆเตเดฏเด เดฌเดซเตผ 1 เดฒเต เดเดดเตเดคเตเด, เดเดคเต เดชเตเดฐเตเดฃเตเดฃเดฎเดพเดฏเดชเตเดชเตเตพ เดจเดฟเดเตเดเดณเตเดเต เดเตเดกเต เดฌเดซเตผ 1 เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเดพเตป เดเดฑเดฟเดฏเดฟเดเตเดเตเดเดฏเตเด DMAC เดฌเดซเตผ 2 เดฏเดฟเตฝ เดเดดเตเดคเตเดเดฏเตเด เดเตเดฏเตเดฏเตเด. เดฌเดซเตผ 2 เดชเตเดฐเตเดฃเตเดฃเดฎเดพเดฏเดพเตฝ, เดจเดฟเดเตเดเดณเตเดเต เดเตเดกเต เดเดฑเดฟเดฏเดฟเดเตเดเตเดเดฏเตเด เดตเตเดฃเตเดเตเด เดฌเดซเตผ 1 เดฒเตเดเดจเด เดเดฐเดเดญเดฟเดเตเดเตเดเดฏเตเด เดเตเดฏเตเดฏเตเด. เดเดฐ BUF_ เดชเตเดฐเตเดฃเตเดฃเดฎเดพเดฏเดคเดฟเดจเต เดเตเดฑเดตเต เดธเดฎเดฏเดคเตเดคเต เดจเดฟเดเตเดเตพ เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเตเดจเตเดจเดคเดฟเดเตเดเดจเต, เดเดฐเต เดกเดพเดฑเตเดฑเดฏเตเด เดจเดทเตเดเดฎเดพเดเดฟเดฒเตเดฒ.

เดเดฐเต เดฌเดซเดฑเตเด เดเดชเตเดเตผ เดเตเดฏเตเดค เดถเตเดทเด, เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเตฝ เดเดดเตเดคเดพเด. เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดจเดฟเตผเดฆเตเดฆเตเดถเดฟเดเตเด เดตเดฟเดฒเดพเดธเดเตเดเตพ เดเดชเดฏเตเดเดฟเดเตเดเต เดเดดเตเดคเดฃเด, เดเดตเดฟเดเต เดเดดเตเดคเดฃเดฎเตเดจเตเดจเตเด เดเดคเตเดฐ เดตเดฒเตเดคเต เดเดดเตเดคเดฃเดฎเตเดจเตเดจเต เดตเตเดฏเดเตเดคเดฎเดพเดเตเดเดฃเด, เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเต เดฌเตเดฑเตเดฑเตเดเดณเตเดเต เดเดเตเดเตเดเตพ เดชเตเดคเตเดเตเดเตเดจเตเดจเดคเตเดชเตเดฒเต. เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดเตเดเต เดเตเดฐเดพเดจเตเดฒเดพเดฐเดฟเดฑเตเดฑเดฟ เดเดฃเตเดเต, เดเตผเดฅเฆพเง เดเดฐเต เดจเดฟเตผเดฆเตเดฆเดฟเดทเตเด เดตเดฒเตเดชเตเดชเดคเตเดคเดฟเตฝ เดฎเดพเดคเตเดฐเดฎเดฒเตเดฒ, เดเดคเต เดตเดฒเตเดชเตเดชเดคเตเดคเดฟเดฒเตเดเตเดเต เดฒเตเตป เดเดเตเดเตเดจเตเดจเดคเดฟเดฒเตเด เดเดถเตเดฐเดฏเดฟเดเตเดเตเดจเตเดจเต. เดเดฆเดพเดนเดฐเดฃเดคเตเดคเดฟเดจเต, เดเตเดฐเดพเดจเตเดฒเดพเดฐเดฟเดฑเตเดฑเดฟ 4096 เดฌเตเดฑเตเดฑเตเดธเต เดเดฃเตเดเตเดเดฟเตฝ, 4200 เดตเดฟเดฒเดพเดธเดคเตเดคเดฟเตฝ เดฎเตเดฑเดฟเดเตเดเตเดฎเดพเดฑเตเดฑเดพเตป เดเดตเดถเตเดฏเดชเตเดชเตเดเตเดฎเตเดชเตเตพ เดเดคเต 4096 เดฎเตเดคเตฝ 8192 เดตเดฐเต เดกเดพเดฑเตเดฑ เดจเตเดเตเดเด เดเตเดฏเตเดฏเดพเด. เดเดคเดฟเดจเดพเตฝ เดเดกเดฟเดฏเต เดกเดพเดฑเตเดฑ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเตฝ เดเดดเตเดคเตเดฎเตเดชเตเตพ เดถเดฐเดฟเดฏเดพเดฏ เดตเดฒเตเดชเตเดชเดคเตเดคเดฟเดฒเต เดเดเตเดเตเดเดณเดพเดฏเดฟ เดตเตเดฃเด.

### เดเดพเดธเตเดเต - เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดเตเตบเดซเดฟเดเตผ เดเตเดฏเตเดฏเตเด

1. PlatformIO เดเดชเดฏเตเดเดฟเดเตเดเต เดชเตเดคเตเดคเตป Wio เดเตเตผเดฎเดฟเดจเตฝ เดชเตเดฐเตเดเดเตเดฑเตเดฑเต เดเดฃเตเดเดพเดเตเดเตเด. เด เดชเตเดฐเตเดเดเตเดฑเตเดฑเดฟเดจเต `smart-timer` เดเดจเตเดจเต เดชเตเดฐเต เดจเดฒเตโเดเตเด. `setup` เดซเดเดเตโเดทเดจเดฟเตฝ เดธเตเดฐเดฟเดฏเตฝ เดชเตเตผเดเตเดเต เดเตเตบเดซเดฟเดเตผ เดเตเดฏเตเดฏเดพเดจเตเดณเตเดณ เดเตเดกเต เดเตเตผเดเตเดเตเด.

1. เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเตเดเตเดเต เดเดเตเดธเดธเต เดจเตฝเดเดพเตป `platformio.ini` เดซเดฏเดฒเดฟเดฒเต เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดฒเตเดฌเตเดฐเดฑเดฟ เดเดถเตเดฐเดฟเดคเดเตเดเตพ เดเตเตผเดเตเดเตเด:

    ```ini
    lib_deps =
        seeed-studio/Seeed Arduino FS @ 2.1.1
        seeed-studio/Seeed Arduino SFUD @ 2.0.2
    ```

1. `main.cpp` เดซเดฏเตฝ เดคเตเดฑเดจเตเดจเต, เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดฒเตเดฌเตเดฐเดฑเดฟเดฏเตเดเต เดเตปเดเตเดฒเตเดกเต เดกเดฏเดฑเดเตเดเตเดตเต เดเตเดชเตเดชเดฟเตฝ เดเตเตผเดเตเดเตเด:

    ```cpp
    #include <sfud.h>
    #include <SPI.h>
    ```

    > ๐ SFUD เฐเฐเฐเฑ Serial Flash Universal Driver, เดเดฒเตเดฒเดพ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดเดฟเดชเตเดเดณเตเดฎเดพเดฏเตเด เดชเตเดฐเดตเตผเดคเตเดคเดฟเดเตเดเดพเตป เดฐเตเดชเดเตฝเดชเตเดชเดจ เดเตเดฏเตเดค เดเดฐเต เดฒเตเดฌเตเดฐเดฑเดฟเดฏเดพเดฃเต

1. `setup` เดซเดเดเตโเดทเดจเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดคเตเดคเต เดซเตเดฒเดพเดทเต เดธเตเดฑเตเดฑเตเดฑเตเดเต เดฒเตเดฌเตเดฐเดฑเดฟ เดธเดเตเดเดฎเดพเดเตเดเตเด:

    ```cpp
    while (!(sfud_init() == SFUD_SUCCESS))
        ;

    sfud_qspi_fast_read_enable(sfud_get_device(SFUD_W25Q32_DEVICE_INDEX), 2);
    ```

    SFUD เดฒเตเดฌเตเดฐเดฑเดฟ เดเตปเดทเดฟเดฏเดฒเตเดธเต เดตเดฐเตเดฏเตเด เด เดฒเตเดชเตเดชเต เดคเตเดเดฐเตเดจเตเดจเต, เดชเดฟเดจเตเดจเตเดเต เดซเดพเดธเตเดฑเตเดฑเต เดฑเตเดกเตเดเตพ เดธเดเตเดเดฎเดพเดเตเดเตเดจเตเดจเต. เดเตปเดฌเดฟเตฝเดฑเตเดฑเต เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเตเดเตเดเต เดเตเดฏเตเดกเต เดธเตเดฐเดฟเดฏเตฝ เดชเตเตผเดซเดฟเดซเดฑเตฝ เดเดจเตเดฑเตผเดซเตเดธเต (QSPI) เดเดชเดฏเตเดเดฟเดเตเดเต เดเดเตโเดธเดธเต เดเตเดฏเตเดฏเดพเด, SPI เดเตบเดเตเดฐเตเดณเดฑเดฟเดจเตเดฑเต เดเดฐเต เดคเดฐเดฎเดพเดฃเดฟเดคเต, เดเดคเต เดชเตเดฐเตเดธเดธเตผ เดเดชเดฏเตเดเดเตเด เดเตเดฑเดเตเดเต เดเตเดฃเตเดเต เดคเตเดเตผเดเตเดเดฏเดพเดฏ เดเดเตเดธเดธเต เดเดจเตเดตเดฆเดฟเดเตเดเตเดจเตเดจเต. เดเดคเดฟเดจเดพเตฝ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเตฝ เดตเดพเดฏเดฟเดเตเดเดพเดจเตเด เดเดดเตเดคเดพเดจเตเด เดเดคเต เดตเตเดเดคเตเดคเดฟเดฒเดพเดฃเต.

1. `src` เดซเตเตพเดกเดฑเดฟเตฝ เดชเตเดคเดฟเดฏ เดเดฐเต เดซเดฏเตฝ `flash_writer.h` เดเดจเตเดจเต เดเดฃเตเดเดพเดเตเดเตเด.

1. เด เดซเดฏเตฝ เดฎเตเดเดณเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    #pragma once

    #include <Arduino.h>
    #include <sfud.h>
    ```

    เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเตเดฎเดพเดฏเดฟ เดธเดเดตเดฆเดฟเดเตเดเดพเตป SFUD เดฒเตเดฌเตเดฐเดฑเดฟเดฏเตเดเต เดนเตเดกเตผ เดซเดฏเดฒเตเด เดเตพเดชเตเดชเตเดเต เดเดฟเดฒ เดเดตเดถเตเดฏเดฎเดพเดฏ เดนเตเดกเตผ เดซเดฏเดฒเตเดเตพ เดเดคเดฟเตฝ เดเดฃเตเดเต

1. เด เดชเตเดคเดฟเดฏ เดนเตเดกเตผ เดซเดฏเดฒเดฟเตฝ `FlashWriter` เดเดจเตเดจ เดเตเดฒเดพเดธเต เดจเดฟเตผเดตเดเดฟเดเตเดเตเด:

    ```cpp
    class FlashWriter
    {
    public:
    
    private:
    };
    ```

1. `private` เดธเตเดเตเดทเดจเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    byte *_sfudBuffer;
    size_t _sfudBufferSize;
    size_t _sfudBufferPos;
    size_t _sfudBufferWritePos;

    const sfud_flash *_flash;
    ```

    เดเดคเต เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเตฝ เดเดดเตเดคเตเดจเตเดจเดคเดฟเดจเต เดฎเตเดฎเตเดชเต เดกเดพเดฑเตเดฑ เดธเดเดญเดฐเดฟเดเตเดเดพเตป เดฌเดซเดฑเดฟเดจเต เดเดตเดถเตเดฏเดฎเดพเดฏ เดซเตเตฝเดกเตเดเตพ เดจเดฟเตผเดตเดเดฟเดเตเดเตเดจเตเดจเต. เดฌเตเดฑเตเดฑเตเดเตพ เดธเฆเงเฆเดฏเดฟเดเตเดเดพเตป `_sfudBuffer` เดฌเตเดฑเตเดฑเต เดเดฐเต เดเดฃเตเดเต, เดเดคเต เดชเตเดฐเตเดฃเตเดฃเดฎเดพเดฏเดพเตฝ เดกเดพเดฑเตเดฑ เดซเตเดฒเดพเดทเดฟเตฝ เดเดดเตเดคเตเด. `_sfudBufferPos` เดซเตเตฝเดกเต เดฌเดซเดฑเดฟเดฒเต เดเดชเตเดชเตเดดเดคเตเดคเต เดเดดเตเดคเตเดคเต เดธเตเดฅเดพเดจเดคเตเดคเต เดธเตเดเดฟเดชเตเดชเดฟเดเตเดเตเดจเตเดจเต, `_sfudBufferWritePos` เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเต เดเดดเตเดคเตเดฃเตเด เดตเดฟเดฒเดพเดธเด เดธเตเดเดฟเดชเตเดชเดฟเดเตเดเตเดจเตเดจเต. `_flash` เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเตเดเตเดเตเดณเตเดณ เดชเตเดฏเดฟเดจเตเดฑเดฑเดพเดฃเต - เดเดฟเดฒ เดฎเตเดเตเดฐเตเดเตบเดเตเดฐเตเดณเดฑเตเดเตพเดเตเดเต เดเดจเตเดจเดฟเตฝ เดเตเดเตเดคเตฝ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดเดฟเดชเตเดเตพ เดเดฃเตเดเดพเดเดพเด.

1. `public` เดธเตเดเตเดทเดจเดฟเตฝ เด เดเตเดฒเดพเดธเต เดเตปเดทเดฟเดฏเดฒเตเดธเต เดเตเดฏเตเดฏเดพเตป เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดฎเตเดคเตเดคเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    void init()
    {
        _flash = sfud_get_device_table() + 0;
        _sfudBufferSize = _flash->chip.erase_gran;
        _sfudBuffer = new byte[_sfudBufferSize];
        _sfudBufferPos = 0;
        _sfudBufferWritePos = 0;
    }
    ```

    เดเดคเต Wio เดเตเตผเดฎเดฟเดจเดฒเดฟเดฒเต เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดเดดเตเดคเดพเดจเดพเดฏเดฟ เดเตเตบเดซเดฟเดเตผ เดเตเดฏเตเดฏเตเดเดฏเตเด เดฌเดซเดฑเตเดเตพ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเตเดเต เดเตเดฐเตเดฏเดฟเตป เดธเตเดธเต เดชเตเดฐเดเดพเดฐเด เดธเดเตเดเดฎเดพเดเตเดเตเดเดฏเตเด เดเตเดฏเตเดฏเตเดจเตเดจเต. เดเดคเต เดเตบเดธเตเดเตเดฐเดเตเดเดฑเดฟเดจเต เดชเดเดฐเด `init` เดฎเตเดคเตเดคเดกเดพเดฃเต, เดเดพเดฐเดฃเด เดเดคเต เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ `setup` เดซเดเดเตโเดทเดจเดฟเตฝ เดธเดเตเดเดฎเดพเดเตเดเดฟเดฏเดคเดฟเดจเต เดถเตเดทเด เดตเดฟเดณเดฟเดเตเดเตเดฃเตเดเดคเดพเดฃเต.

1. `public` เดธเตเดเตเดทเดจเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    void writeSfudBuffer(byte b)
    {
        _sfudBuffer[_sfudBufferPos++] = b;
        if (_sfudBufferPos == _sfudBufferSize)
        {
            sfud_erase_write(_flash, _sfudBufferWritePos, _sfudBufferSize, _sfudBuffer);
            _sfudBufferWritePos += _sfudBufferSize;
            _sfudBufferPos = 0;
        }
    }

    void writeSfudBuffer(byte *b, size_t len)
    {
        for (size_t i = 0; i < len; ++i)
        {
            writeSfudBuffer(b[i]);
        }
    }

    void flushSfudBuffer()
    {
        if (_sfudBufferPos > 0)
        {
            sfud_erase_write(_flash, _sfudBufferWritePos, _sfudBufferSize, _sfudBuffer);
            _sfudBufferWritePos += _sfudBufferSize;
            _sfudBufferPos = 0;
        }
    }
    ```

    เด เดเตเดกเต เดซเตเดฒเดพเดทเต เดธเตเดฑเตเดฑเตเดฑเตเดเต เดธเดฟเดธเตเดฑเตเดฑเดคเตเดคเดฟเดฒเตเดเตเดเต เดฌเตเดฑเตเดฑเตเดเตพ เดเดดเตเดคเดพเดจเตเดณเตเดณ เดฎเตเดคเตเดคเดกเตเดเตพ เดจเดฟเตผเดตเดเดฟเดเตเดเตเดจเตเดจเต. เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเตเดเต เดถเดฐเดฟเดฏเดพเดฏ เดตเดฒเตเดชเตเดชเดคเตเดคเดฟเดฒเตเดณเตเดณ เดเตป-เดฎเตเดฎเตเดฎเดฑเดฟ เดฌเดซเดฑเดฟเดฒเตเดเตเดเต เดเดดเตเดคเตเดจเตเดจเต, เดเดคเต เดชเตเดฐเตเดฃเตเดฃเดฎเดพเดฏเดพเตฝ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเตเดเตเดเต เดเดดเตเดคเดฟ เดชเดคเดฟเดเตเด เดกเดพเดฑเตเดฑ เดเดฒเตเดฒเดพเดคเดพเดเตเดเตเดจเตเดจเต. เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเตเดเตเดเต เดเดชเตเตผเดฃเตเดฃ เดฌเดซเตผ เดเดดเตเดคเดพเตป `flushSfudBuffer` เดเดฃเตเดเต, เดเดพเดฐเดฃเด เดเดชเตเดเตผ เดเตเดฏเตเดค เดกเดพเดฑเตเดฑ เดเตเดฐเตเดฏเดฟเตป เดธเตเดธเดฟเดจเตเดฑเต เดเตเดเตเดเต เดเดฏเดฟเดฐเดฟเดเตเดเดฟเดฒเตเดฒ, เดเดคเตเดเตเดฃเตเดเต เดเดตเดธเดพเดจเด เดญเดพเดเด เดจเดฟเดฒเดตเดฟเดฒเตเดณเตเดณ เดฎเตเดดเตเดตเตป เดกเดพเดฑเตเดฑ เดเดดเตเดคเดฟ เดชเดฟเตปเดตเดพเดเตเดเตเดจเตเดจเต.

    > ๐ เดกเดพเดฑเตเดฑเดฏเตเดเต เดเดตเดธเดพเดจเด เดเดงเดฟเดเดฎเดพเดฏ เดเดจเดพเดตเดถเตเดฏ เดกเดพเดฑเตเดฑ เดเดดเตเดคเดฟเดฏเตเดชเตเดชเตเดดเตเด, เดเดตเดถเตเดฏเดฎเดพเดฏ เดกเดพเดฑเตเดฑ เดฎเดพเดคเตเดฐเดฎเต เดตเดพเดฏเดฟเดเตเดเดชเตเดชเตเดเตเดเดฏเตเดณเตเดณเต, เดเดคเตเดเตเดฃเตเดเต เดชเตเดฐเดถเตเดจเดฎเดฟเดฒเตเดฒ.

### เดเดพเดธเตเดเต - เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดธเดเตเดเดฎเดพเดเตเดเตเด

1. `src` เดซเตเตพเดกเดฑเดฟเตฝ เดชเตเดคเดฟเดฏ เดซเดฏเตฝ `config.h` เดเดจเตเดจเต เดเดฃเตเดเดพเดเตเดเตเด.

1. เด เดซเดฏเตฝ เดฎเตเดเดณเดฟเตฝ เดเตเดตเดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    #pragma once

    #define RATE 16000
    #define SAMPLE_LENGTH_SECONDS 4
    #define SAMPLES RATE * SAMPLE_LENGTH_SECONDS
    #define BUFFER_SIZE (SAMPLES * 2) + 44
    #define ADC_BUF_LEN 1600
    ```

    เดเดคเต เดเดกเดฟเดฏเต เดเดชเตเดเดฑเดฟเดจเดพเดฏเตเดณเตเดณ เดเดฟเดฒ เดเตเตบเดธเตเดฑเตเดฑเดจเตเดฑเตเดเตพ เดธเดเตเดเดฎเดพเดเตเดเตเดจเตเดจเต.

    | เดเตเตบเดธเตเดฑเตเดฑเดจเตเดฑเต           | เดฎเตเดฒเตเดฏเด  | เดตเดฟเดตเดฐเดฃเด |
    | -------------------- | ------: | - |
    | RATE                 | 16000   | เดเดกเดฟเดฏเต เดธเดพเดเดชเดฟเตพ เดจเดฟเดฐเดเตเดเต. 16,000 เดเดจเตเดจเดคเต 16KHz เดเดฃเต |
    | SAMPLE_LENGTH_SECONDS| 4       | เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเดฃเตเด เดเดกเดฟเดฏเต เดฆเตเตผเดเตเดฏเด. เดเดคเต 4 เดธเตเดเตเดเตปเดกเดพเดฏเดฟ เดธเดเตเดเดฎเดพเดเตเดเดฟเดฏเดฟเดฐเดฟเดเตเดเตเดจเตเดจเต. เดจเตเดเตเดเดฟ เดฑเตเดเตเดเตเตผเดกเต เดเตเดฏเตเดฏเดพเตป เดเดคเต เดเตเดเตเดเดพเด. |
    | SAMPLES              | 64000   | เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเดฃเตเด เดเดกเดฟเดฏเต เดธเดพเดเดชเดฟเดณเตเดเดณเตเดเต เดเดเต เดเดฃเตเดฃเด. เดธเดพเดเดชเดฟเตพ เดจเดฟเดฐเดเตเดเตเด เดธเตเดเตเดเตปเดกเตเดเดณเตเดเต เดเดฃเตเดฃเด เดตเตผเดฆเตเดงเดฟเดชเตเดชเดฟเดเตเดเดฟเดเตเดเดพเดฃเต เดธเดเตเดเดฎเดพเดเตเดเดฟเดฏเดคเต |
    | BUFFER_SIZE          | 128044  | เดเดกเดฟเดฏเต เดฌเดซเดฑเดฟเดจเตเดฑเต เดตเดฒเตเดชเตเดชเด. เดเดกเดฟเดฏเต WAV เดซเดฏเดฒเดพเดฏเดฟ เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเด, เดเดคเตเดพเดฏเต 44 เดฌเตเดฑเตเดฑเตเดธเต เดนเตเดกเดฑเตเด, 128,000 เดฌเตเดฑเตเดฑเตเดธเต เดเดกเดฟเดฏเต เดกเดพเดฑเตเดฑเดฏเตเด (เดเดฐเต เดธเดพเดเดชเดฟเตพ 2 เดฌเตเดฑเตเดฑเตเดเตพ) เดเตพเดเตเดเตเดจเตเดจเต |
    | ADC_BUF_LEN          | 1600    | DMAC เดจเดฟเดจเตเดจเต เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเดพเตป เดเดชเดฏเตเดเดฟเดเตเดเตเดจเตเดจ เดฌเดซเดฑเตเดเดณเตเดเต เดตเดฒเตเดชเตเดชเด |

    > ๐ 4 เดธเตเดเตเดเตปเดกเต เดธเดฎเดฏ เดชเดฐเดฟเดงเดฟ เดเตเดฑเดตเดพเดฃเตเดเตเดเดฟเตฝ, `SAMPLE_LENGTH_SECONDS` เดฎเตเดฒเตเดฏเด เดเตเดเตเดเดพเด, เดเดฒเตเดฒเดพ เดตเดณเดฏเดฃเดตเตเดฎเตเดณเตเดณเดคเดพเดฃเต.

1. `src` เดซเตเตพเดกเดฑเดฟเตฝ เดชเตเดคเดฟเดฏ เดซเดฏเตฝ `mic.h` เดเดฃเตเดเดพเดเตเดเตเด.

1. เด เดซเดฏเตฝ เดฎเตเดเดณเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    #pragma once

    #include <Arduino.h>

    #include "config.h"
    #include "flash_writer.h"
    ```

    เดเดคเต เดเดฟเดฒ เดเดตเดถเตเดฏเดฎเดพเดฏ เดนเตเดกเตผ เดซเดฏเดฒเตเดเตพ เดเตพเดเตเดเตเดณเตเดณเตเดจเตเดจเต, เดเดคเดฟเตฝ `config.h` เดเตเดเดพเดคเต `FlashWriter` เดนเตเดกเดฑเตเด เดเดฃเตเดเต.

1. เดฎเตเดเตเดฐเตเดซเตเดฃเดฟเตฝ เดจเดฟเดจเตเดจเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเดพเดจเตเดณเดณ `Mic` เดเตเดฒเดพเดธเต เดจเดฟเตผเดตเดเดฟเดฏเตเดเตเดเดพเตป เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    class Mic
    {
    public:
        Mic()
        {
            _isRecording = false;
            _isRecordingReady = false;
        }
    
        void startRecording()
        {
            _isRecording = true;
            _isRecordingReady = false;
        }
    
        bool isRecording()
        {
            return _isRecording;
        }
    
        bool isRecordingReady()
        {
            return _isRecordingReady;
        }
    
    private:
        volatile bool _isRecording;
        volatile bool _isRecordingReady;
        FlashWriter _writer;
    };
    
    Mic mic;
    ```

    เด เดเตเดฒเดพเดธเดฟเดจเต เดจเดฟเดฒเดตเดฟเตฝ เดฑเตเดเตเดเตเตผเดกเดฟเดเดเต เดคเตเดเดเตเดเดฟเดฏเดฟเดเตเดเตเดฃเตเดเต เดเดจเตเดจเต เดเดพเดฃเดพเดจเตเดณเตเดณ เดฐเดฃเตเดเต เดซเตเตฝเดกเตเดเตพ เดฎเดพเดคเตเดฐเดฎเต เดเดณเตเดณเต, เดเตเดเดพเดคเต เดฑเตเดเตเดเตเตผเดกเดฟเดเดเต เดเดชเดฏเตเดเดฟเดเตเดเดพเตป เดคเดฏเตเดฏเดพเดฑเดพเดฏเดฟเดเตเดเตเดฃเตเดเต เดเดจเตเดจเตเด เดธเตเดเดฟเดชเตเดชเดฟเดเตเดเตเดจเตเดจเต. DMAC เดธเดเตเดเดฎเดพเดเตเดเดฟเดฏเดพเตฝ เดคเตเดเตผเดเตเดเดฏเดพเดฏเดฟ เดฎเตเดฎเตเดฎเดฑเดฟ เดฌเดซเดฑเตเดเดณเดฟเตฝ เดเดดเตเดคเตเด, เดเดคเดฟเดจเดพเตฝ `_isRecording` เดซเตเดฒเดพเดเต เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเดฃเต เดเดฒเตเดฒเดฏเต เดเดฃเตเดเตเดเดฟเดฒเต เดจเดฟเตผเดฃเตเดฃเดฏเดฟเดเตเดเตเด. 4 เดธเตเดเตเดเตปเดกเต เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดคเดพเตฝ `_isRecordingReady` เดซเตเดฒเดพเดเต true เดเดฏเตเด เดธเดเตเดเดฎเดพเดเตเด. `_writer` เดซเตเตฝเดกเต เดเดกเดฟเดฏเต เดกเดพเดฑเตเดฑ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเดฒเตเดเตเดเต เดธเตเดตเต เดเตเดฏเตเดฏเดพเตป เดเดชเดฏเตเดเดฟเดเตเดเตเด.

    `Mic` เดเตเดฒเดพเดธเดฟเดจเตเดฑเต เดเดฐเต เดเตเดฒเตเดฌเตฝ เดเตปเดธเตเดฑเตเดฑเตปเดธเต เดชเดฟเดจเตเดจเตเดเต เดชเตเดฐเดเตเดฏเดพเดชเดฟเดเตเดเตเดจเตเดจเต.

1. `Mic` เดเตเดฒเดพเดธเต `private` เดธเตเดเตเดทเดจเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    typedef struct
    {
        uint16_t btctrl;
        uint16_t btcnt;
        uint32_t srcaddr;
        uint32_t dstaddr;
        uint32_t descaddr;
    } dmacdescriptor;

    // เดเตเดฒเตเดฌเตฝเดธเต - DMA เดเดจเตเดฑเต ADC
    volatile dmacdescriptor _wrb[DMAC_CH_NUM] __attribute__((aligned(16)));
    dmacdescriptor _descriptor_section[DMAC_CH_NUM] __attribute__((aligned(16)));
    dmacdescriptor _descriptor __attribute__((aligned(16)));

    void configureDmaAdc()
    {
        // DMA เดจเต เดเดกเดฟเดธเดฟ เดจเดฟเดจเตเดจเตเด เดเดฐเต เดธเตเดฅเดฟเดฐเดฎเดพเดฏ เดเดเดตเตเดณเดฏเดฟเดฒเตโ เดธเดพเดฎเตเดชเดฟเดณเตโ เดเตเดฏเตเดฏเดพเดจเตโ เดเตเตบเดซเดฟเดเตผ เดเตเดฏเตเดฏเตเด (เดเตเดฎเตผ/เดเตเดฃเตเดเตผ เดตเดดเดฟ เดเตเดฐเดฟเดเตเดเตผ เดเตเดฏเตเดฏเตเดจเตเดจเต)
        DMAC->BASEADDR.reg = (uint32_t)_descriptor_section;                    // เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเดฑเตเดเดณเตเดเต เดธเตเดฅเดฒเด เดตเตเดฏเดเตเดคเดฎเดพเดเตเดเตเด
        DMAC->WRBADDR.reg = (uint32_t)_wrb;                                    // เดฑเตเดฑเตเดฑเต เดฌเดพเดเตเดเต เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเดฑเตเดเดณเตเดเต เดธเตเดฅเดฒเด เดตเตเดฏเดเตเดคเดฎเดพเดเตเดเตเด
        DMAC->CTRL.reg = DMAC_CTRL_DMAENABLE | DMAC_CTRL_LVLEN(0xf);           // DMAC เดชเตเดฐเดฟเดซเตเดฑเตฝ เดธเดเตเดตเดฎเดพเดเตเดเตเด
        DMAC->Channel[1].CHCTRLA.reg = DMAC_CHCTRLA_TRIGSRC(TC5_DMAC_ID_OVF) | // TC5 เดเตเดฎเตผ เดเดตเตผเดซเตเดฒเตเดฏเดฟเตฝ DMAC เดเตเดฐเดฟเดเตเดเตผ เดเตเดฏเตเดฏเตเด
                                        DMAC_CHCTRLA_TRIGACT_BURST;             // DMAC เดฌเตผเดธเตเดฑเตเดฑเต เดเตเดฐเดพเตปเดธเตเดซเตผ

        _descriptor.descaddr = (uint32_t)&_descriptor_section[1];                    // เดเดฐเต เดธเตผเดเตเดเตเดฒเตผ เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเตผ เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
        _descriptor.srcaddr = (uint32_t)&ADC1->RESULT.reg;                           // ADC0 RESULT เดฐเดเดฟเดธเตเดฑเตเดฑเดฑเดฟเตฝ เดจเดฟเดจเตเดจเตเด เดซเดฒเด เดเดเตเดเตเดเตเด
        _descriptor.dstaddr = (uint32_t)_adc_buf_0 + sizeof(uint16_t) * ADC_BUF_LEN; // เดเดคเต adc_buf_0 เดเดฑเตเดฏเดฟเตฝ เดเดเตเด
        _descriptor.btcnt = ADC_BUF_LEN;                                             // เดฌเตเดฑเตเดฑเต เดเดฃเตเดฃเฎฟเฎเฏเฎเฏ
        _descriptor.btctrl = DMAC_BTCTRL_BEATSIZE_HWORD |                            // เดฌเตเดฑเตเดฑเต เดตเดฒเตเดชเตเดชเด HWORD (16-เดฌเดฟเดฑเตเดฑเตเดเตพ) เดเดฃเต
                                DMAC_BTCTRL_DSTINC |                                    // เดเดฎเตเดฏเดธเตเดฅเดพเดจเด เดตเดฟเดฒเดพเดธเด เดตเตผเดฆเตเดงเดฟเดชเตเดชเดฟเดเตเดเตเด
                                DMAC_BTCTRL_VALID |                                     // เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเตผ เดธเดพเดงเตเดตเดพเดฃเต
                                DMAC_BTCTRL_BLOCKACT_SUSPEND;                           // เดฌเตเดฒเตเดเตเดเต เดเตเดฐเดพเตปเดธเตเดซเตผ เดเดดเดฟเดเตเดเต DMAC เดเดพเดจเตฝ 0 เดคเดพเตฝเดเตเดเดพเดฒเดฟเดเดฎเดพเดฏเดฟ เดจเดฟเตผเดคเตเดคเตเด
        memcpy(&_descriptor_section[0], &_descriptor, sizeof(_descriptor));          // เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเตผ เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเตผ เดญเดพเดเดคเตเดคเดฟเดฒเตเดเตเดเต เดจเดเดฒเตโ เดเตเดฏเตเดฏเตเด

        _descriptor.descaddr = (uint32_t)&_descriptor_section[0];                    // เดเดฐเต เดธเตผเดเตเดเตเดฒเตผ เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเตผ เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
        _descriptor.srcaddr = (uint32_t)&ADC1->RESULT.reg;                           // ADC0 RESULT เดฐเดเดฟเดธเตเดฑเตเดฑเดฑเดฟเตฝ เดจเดฟเดจเตเดจเตเด เดซเดฒเด เดเดเตเดเตเดเตเด
        _descriptor.dstaddr = (uint32_t)_adc_buf_1 + sizeof(uint16_t) * ADC_BUF_LEN; // เดเดคเต adc_buf_1 เดเดฑเตเดฏเดฟเตฝ เดเดเตเด
        _descriptor.btcnt = ADC_BUF_LEN;                                             // เดฌเตเดฑเตเดฑเต เดเดฃเตเดฃเฎฟเฎเฏเฎเฏ
        _descriptor.btctrl = DMAC_BTCTRL_BEATSIZE_HWORD |                            // เดฌเตเดฑเตเดฑเต เดตเดฒเตเดชเตเดชเด HWORD (16-เดฌเดฟเดฑเตเดฑเตเดเตพ) เดเดฃเต
                                DMAC_BTCTRL_DSTINC |                                    // เดเดฎเตเดฏเดธเตเดฅเดพเดจเด เดตเดฟเดฒเดพเดธเด เดตเตผเดฆเตเดงเดฟเดชเตเดชเดฟเดเตเดเตเด
                                DMAC_BTCTRL_VALID |                                     // เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเตผ เดธเดพเดงเตเดตเดพเดฃเต
                                DMAC_BTCTRL_BLOCKACT_SUSPEND;                           // เดฌเตเดฒเตเดเตเดเต เดเตเดฐเดพเตปเดธเตเดซเตผ เดเดดเดฟเดเตเดเต DMAC เดเดพเดจเตฝ 0 เดคเดพเตฝเดเตเดเดพเดฒเดฟเดเดฎเดพเดฏเดฟ เดจเดฟเตผเดคเตเดคเตเด
        memcpy(&_descriptor_section[1], &_descriptor, sizeof(_descriptor));          // เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเตผ เดกเดฟเดธเตเดเตเดฐเดฟเดชเตเดฑเตเดฑเตผ เดญเดพเดเดคเตเดคเดฟเดฒเตเดเตเดเต เดจเดเดฒเตโ เดเตเดฏเตเดฏเตเด

        // NVIC เดเตเตบเดซเดฟเดเตผ เดเตเดฏเตเดฏเตเด
        NVIC_SetPriority(DMAC_1_IRQn, 0); // DMAC1 เดจเต Nested Vector Interrupt Controller (NVIC) เดฎเตเตปเดเดฃเดจ 0 (เดเดคเตเดฏเดงเดฟเดเด) เดเดจเตเดจเต เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
        NVIC_EnableIRQ(DMAC_1_IRQn);      // DMAC1 เดจเต Nested Vector Interrupt Controller (NVIC) เดฏเตเดฎเดพเดฏเดฟ เดฌเดจเตเดงเดฟเดชเตเดชเดฟเดเตเดเตเด

        // DMAC เดเดพเดจเตฝ 1 เดฒเตโ เดธเดธเตเดชเตเดจเตเดฑเต (SUSP) เดเดจเตเดฑเตผเดชเตเดฑเตเดฑเต เดธเดเตเดตเดฎเดพเดเตเดเตเด
        DMAC->Channel[1].CHINTENSET.reg = DMAC_CHINTENSET_SUSP;

        // ADC เดเตเตบเดซเดฟเดเตผ เดเตเดฏเตเดฏเตเด
        ADC1->INPUTCTRL.bit.MUXPOS = ADC_INPUTCTRL_MUXPOS_AIN12_Val; // เดเดจเดพเดฒเตเดเต เดเตปเดชเตเดเตเดเต ADC0/AIN2 (PB08 - Metro M4 เดจเต A4) เดเดฏเดฟ เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
        while (ADC1->SYNCBUSY.bit.INPUTCTRL)
            ;                              // เดธเดฟเดเตเดเตเดฐเดฃเตเดธเตเดทเดจเดพเดฏเดฟ เดเดพเดคเตเดคเดฟเดฐเดฟเดเตเดเตเด
        ADC1->SAMPCTRL.bit.SAMPLEN = 0x00; // เดชเดฐเดฎเดพเดตเดงเดฟ เดธเดพเดฎเตเดชเดฟเดณเดฟเดเดเต เดธเดฎเดฏเด ADC เดเตเดฒเตเดเตเดเต เดชเตพเดธเต เดเฆฐเงเฆงเดญเดพเดเด (2.66us) เดเดฏเดฟ เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
        while (ADC1->SYNCBUSY.bit.SAMPCTRL)
            ;                                         // เดธเดฟเดเตเดเตเดฐเดฃเตเดธเตเดทเดจเดพเดฏเดฟ เดเดพเดคเตเดคเดฟเดฐเดฟเดเตเดเตเด
        ADC1->CTRLA.reg = ADC_CTRLA_PRESCALER_DIV128; // ADC GCLK 128 เดจเตเด 48MHz/128 = 375kHz เดเดฏเดฟ เดเตเดฒเตเดเตเดเต เดตเดฟเดญเดเดฟเดเตเดเตเด
        ADC1->CTRLB.reg = ADC_CTRLB_RESSEL_12BIT |    // ADC เดฑเตเดธเดฒเตเดทเตป 12-เดฌเดฟเดฑเตเดฑเต เดเดฏเดฟ เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
                            ADC_CTRLB_FREERUN;          // ADC เดซเตเดฐเต เดฑเตบ เดฎเตเดกเดพเดฏเดฟ เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
        while (ADC1->SYNCBUSY.bit.CTRLB)
            ;                       // เดธเดฟเดเตเดเตเดฐเดฃเตเดธเตเดทเดจเดพเดฏเดฟ เดเดพเดคเตเดคเดฟเดฐเดฟเดเตเดเตเด
        ADC1->CTRLA.bit.ENABLE = 1; // ADC เดธเดเตเดตเดฎเดพเดเตเดเตเด
        while (ADC1->SYNCBUSY.bit.ENABLE)
            ;                       // เดธเดฟเดเตเดเตเดฐเดฃเตเดธเตเดทเดจเดพเดฏเดฟ เดเดพเดคเตเดคเดฟเดฐเดฟเดเตเดเตเด
        ADC1->SWTRIG.bit.START = 1; // ADC เดเตบเดตเตเตผเดทเตป เดคเตเดเดเตเดเดพเตป เดธเตเดซเตเดฑเตเดฑเตเดตเตเตผ เดเตเดฐเดฟเดเตเดเตผ เดคเตเดเดเตเดเตเด
        while (ADC1->SYNCBUSY.bit.SWTRIG)
            ; // เดธเดฟเดเตเดเตเดฐเดฃเตเดธเตเดทเดจเดพเดฏเดฟ เดเดพเดคเตเดคเดฟเดฐเดฟเดเตเดเตเด

        // DMA เดเดพเดจเตฝ 1 เดธเดเตเดตเดฎเดพเดเตเดเตเด
        DMAC->Channel[1].CHCTRLA.bit.ENABLE = 1;

        // เดเตเดฎเตผ/เดเตเดฃเตเดเตผ 5 เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
        GCLK->PCHCTRL[TC5_GCLK_ID].reg = GCLK_PCHCTRL_CHEN |     // TC5 เดธเดเตเดตเดฎเตเดณเตเดณ เดชเตเดฐเดฟเดซเตเดฑเตฝ เดเดพเดจเตฝ เดธเดเตเดเดฎเดพเดเตเดเตเด
                                            GCLK_PCHCTRL_GEN_GCLK1; // เดเดจเดฑเดฟเดเต เดเตเดฒเตเดเตเดเต 0 เดจเต 48MHz เดเดฃเดเตเดฑเตเดฑเต เดเตเดฏเตเดฏเตเด

        TC5->COUNT16.WAVE.reg = TC_WAVE_WAVEGEN_MFRQ; // TC5 เดจเต เดฎเดพเดเตเดเต เดซเตเดฐเตเดเตเดตเตปเดธเดฟ (MFRQ) เดฎเตเดกเดฟเดฒเตเดเตเดเต เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด
        TC5->COUNT16.CC[0].reg = 3000 - 1;            // 16 kHz เดเตเดฐเดฟเดเตเดเตผ เดเตเดฐเดฎเตเดเดฐเดฟเดเตเดเตเด: (4Mhz / 16000) - 1
        while (TC5->COUNT16.SYNCBUSY.bit.CC0)
            ; // เดธเดฟเดเตเดเตเดฐเดฃเตเดธเตเดทเดจเดพเดฏเดฟ เดเดพเดคเตเดคเดฟเดฐเดฟเดเตเดเตเด

        // เดเตเดฎเตผ/เดเตเดฃเตเดเตผ 5 เดเดฐเดเดญเดฟเดเตเดเตเด
        TC5->COUNT16.CTRLA.bit.ENABLE = 1; // TC5 เดเตเดฎเตผ เดธเดเตเดตเดฎเดพเดเตเดเตเด
        while (TC5->COUNT16.SYNCBUSY.bit.ENABLE)
            ; // เดธเดฟเดเตเดเตเดฐเดฃเตเดธเตเดทเดจเดพเดฏเดฟ เดเดพเดคเตเดคเดฟเดฐเดฟเดเตเดเตเด
    }

    uint16_t _adc_buf_0[ADC_BUF_LEN];
    uint16_t _adc_buf_1[ADC_BUF_LEN];
    ```

    เดเดตเดฟเดเต `configureDmaAdc` เดฎเตเดคเตเดคเดกเตเดดเตเดคเดฟ DMAC เดเตเตบเดซเดฟเดเตผ เดเตเดฏเตเดฏเตเดจเตเดจเต, ADC เดฏเตเดฎเดพเดฏเดฟ เดฌเดจเตเดงเดฟเดชเตเดชเดฟเดเตเดเต, เดฐเดฃเตเดเต เดตเตเดฑเดฟเดเตเด เดฌเดซเดฑเตเดเตพ `_adc_buf_0`, `_adc_buf_1` ๋ฒ๊ฐ์ เดเดชเดฏเตเดเดฟเดเตเดเดพเตป เดธเดเตเดเดฎเดพเดเตเดเตเดจเตเดจเต.

    > ๐ เดฎเตเดเตเดฐเตcontroller เดกเตเดตเดฒเดชเตเดชเตเดฎเตเดจเตเดฑเดฟเดจเตเดฑเต เดเดฐเต เดฒเตเดฎเตเดชเดพเดเต เดเตเดกเต เดนเดพเตผเดกเตเดตเตเดฏเตผ เดเตเดจเตเดฆเตเดฐเตเดเดฐเดฟเดเตเดเต เดตเดณเดฐเต เดคเดพเดดเตเดจเตเดจ เดธเตเดคเตเดงเดพเดฏเดฟเดฏเดฟเตฝ เดชเตเดฐเดตเตผเดคเตเดคเดฟเดเตเดเตเดจเตเดจเดคเดฟเดจเดพเตฝ เดเตเดกเต เดตเดณเดฐเต เดธเดเตเดเตเตผเดฃเดฎเดพเดฃเต. เดธเดฟเดเดเดฟเตพ-เดฌเตเตผเดกเต เดเดฎเตเดชเตเดฏเตเดเตเดเตผ เดเดฒเตเดฒเตเดเตเดเดฟเตฝ เดตเตเดฏเดตเดธเดพเดฏ เดเดฎเตเดชเตเดฏเตเดเตเดเดฑเดฟเดจเต เดคเตเดฒเตเดฏเดฎเดพเดฏ เดเดชเตเดชเดฑเตเดฑเตเดฑเดฟเดเดเต เดธเดฟเดธเตเดฑเตเดฑเด เดเดฒเตเดฒ. เดเตบเดธเดฟเดฎเตเดชเดฟเดณเดฟเดซเต เดเตเดฏเตเดฏเดพเตป เดเดฟเดฒ เดฒเตเดฌเตเดฐเดฑเดฟเดเตพ เดเดฃเตเดเต, เดชเดเตเดทเต เดเดคเตเด เดเดธเตเดเดเดฐเดฎเดพเดฃเต.

1. เดเดคเดฟเดจเตเดถเตเดทเด เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    // WAV เดซเดฏเดฒเตเดเตพเดเตเดเต เดเดฐเต เดนเตเดกเตผ เดเดฃเตเดเต. เด เดเดเดจ เด เดนเตเดกเตผ เดจเดฟเตผเดตเตเดตเดเดฟเดเตเดเตเดจเตเดจเต
    struct wavFileHeader
    {
        char riff[4];         /* "RIFF"                                  */
        long flength;         /* file length in bytes                    */
        char wave[4];         /* "WAVE"                                  */
        char fmt[4];          /* "fmt "                                  */
        long chunk_size;      /* size of FMT chunk in bytes (usually 16) */
        short format_tag;     /* 1=PCM, 257=Mu-Law, 258=A-Law, 259=ADPCM */
        short num_chans;      /* 1=mono, 2=stereo                        */
        long srate;           /* Sampling rate in samples per second     */
        long bytes_per_sec;   /* bytes per second = srate*bytes_per_samp */
        short bytes_per_samp; /* 2=16-bit mono, 4=16-bit stereo          */
        short bits_per_samp;  /* Number of bits per sample               */
        char data[4];         /* "data"                                  */
        long dlength;         /* data length in bytes (filelength - 44)  */
    };

    void initBufferHeader()
    {
        wavFileHeader wavh;

        strncpy(wavh.riff, "RIFF", 4);
        strncpy(wavh.wave, "WAVE", 4);
        strncpy(wavh.fmt, "fmt ", 4);
        strncpy(wavh.data, "data", 4);

        wavh.chunk_size = 16;
        wavh.format_tag = 1; // PCM
        wavh.num_chans = 1;  // เดฎเตเดจเต
        wavh.srate = RATE;
        wavh.bytes_per_sec = (RATE * 1 * 16 * 1) / 8;
        wavh.bytes_per_samp = 2;
        wavh.bits_per_samp = 16;
        wavh.dlength = RATE * 2 * 1 * 16 / 2;
        wavh.flength = wavh.dlength + 44;

        _writer.writeSfudBuffer((byte *)&wavh, 44);
    }
    ```

    เด เดเตเดกเต 44 เดฌเตเดฑเตเดฑเดฟเดจเตเดฑเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเตเดณเตเดณ WAV เดนเตเดกเตผ เดธเตเดเตเดฐเดเตเดเตผ เดเดฏเดฟ เดจเดฟเตผเดตเดเดฟเดเตเดเตเดจเตเดจเต. เดเดคเต เดเดกเดฟเดฏเต เดซเดฏเตฝ เดจเดฟเดฐเดเตเดเต, เดตเดฒเตเดชเตเดชเด, เดเดพเดจเดฒเตเดเดณเตเดเต เดเดฃเตเดฃเด เดฎเตเดคเดฒเดพเดฏเดตเดฏเต เดเตเดฑเดฟเดเตเดเต เดตเดฟเดตเดฐเดเตเดเตพ เดเดดเตเดคเตเดจเตเดจเต. เดชเดฟเดจเตเดจเตเดเต เด เดนเตเดกเตผ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟเดฏเดฟเตฝ เดเดดเตเดคเตเดจเตเดจเต.

1. เดเดคเดฟเดจเต เดคเดพเดดเต, เดเดกเดฟเดฏเต เดฌเดซเดฑเตเดเตพ เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเตเดฃเตเด เดธเดฎเดฏเดคเตเดคเต เดตเดฟเดณเดฟเดเตเดเดพเตป เดเดฐเต เดฎเตเดคเตเดคเดกเดฟเดจเตเดฑเต เดชเตเดฐเดเตเดฏเดพเดชเดจเด เดเตเตผเดเตเดเตเด:

    ```cpp
    void audioCallback(uint16_t *buf, uint32_t buf_len)
    {
        static uint32_t idx = 44;

        if (_isRecording)
        {
            for (uint32_t i = 0; i < buf_len; i++)
            {
                int16_t audio_value = ((int16_t)buf[i] - 2048) * 16;

                _writer.writeSfudBuffer(audio_value & 0xFF);
                _writer.writeSfudBuffer((audio_value >> 8) & 0xFF);
            }

            idx += buf_len;
                
            if (idx >= BUFFER_SIZE)
            {
                _writer.flushSfudBuffer();
                idx = 44;
                _isRecording = false;
                _isRecordingReady = true;
            }
        }
    }
    ```

    เดเดกเดฟเดฏเต เดฌเดซเดฑเตเดเตพ 16-เดฌเดฟเดฑเตเดฑเต เดเดจเตเดฑเดฟเดเดฑเตเดเดณเตเดเต เดเดฐเตเดเตพ เดเดฃเต ADC เดจเดฟเดจเตเดจเตเดณเตเดณ เดเดกเดฟเดฏเต เดเตพเดเตเดเตเดณเตเดณเตเดจเตเดจ. ADC 12-เดฌเดฟเดฑเตเดฑเต เดเตบเดธเตเดจเดกเต เดฎเตเดฒเตเดฏเดเตเดเตพ (0-1023) เดจเตฝเดเตเดจเตเดจเต, เดเดคเดฟเดจเดพเตฝ เดเดต 16-เดฌเดฟเดฑเตเดฑเต เดธเตเตปเดกเต เดฎเตเดฒเตเดฏเดเตเดเดณเดพเดฏเดฟ เดฎเดพเดฑเตเดฑเดฟ, เดชเดฟเดจเตเดจเตเดเต 2 เดฌเตเดฑเตเดฑเตเดเดณเดพเดฏเดฟ เดฎเดพเดฑเตเดฑเดฟ เดฑเดพเดตเต เดฌเตเดจเดฑเดฟ เดกเดพเดฑเตเดฑ เดเดเตเดเตเดจเตเดจเต.

    เด เดฌเตเดฑเตเดฑเตเดเตพ เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดฌเดซเดฑเตเดเดณเดฟเตฝ เดเดดเตเดคเตเดจเตเดจเต. เดเดดเตเดคเตเดคเต 44 เดธเตเดฅเดพเดจเดคเตเดคเตเดเต เดคเตเดเดเตเดเตเดจเตเดจเต - เดเดคเต WAV เดซเดฏเตฝ เดนเตเดกเตผ เดเดดเตเดคเดฟเดฏ 44 เดฌเตเดฑเตเดฑเดธเต เดเดซเตเดธเตเดฑเตเดฑเดพเดฃเต. เดเดตเดถเตเดฏเดฎเตเดณเตเดณ เดเดกเดฟเดฏเต เดฆเตเตผเดเตเดฏเดคเตเดคเดฟเดจเต เดเดตเดถเตเดฏเดฎเดพเดฏ เดฌเตเดฑเตเดฑเตเดเตพ เดเดชเตเดเตผ เดเตเดฏเตเดคเดพเตฝ เดฌเดพเดเตเดเดฟ เดกเดพเดฑเตเดฑ เดซเตเดฒเดพเดทเดฟเดฒเตเดเตเดเต เดเดดเตเดคเตเด.

1. `Mic` เดเตเดฒเดพเดธเต `public` เดธเตเดเตเดทเดจเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    void dmaHandler()
    {
        static uint8_t count = 0;

        if (DMAC->Channel[1].CHINTFLAG.bit.SUSP)
        {
            DMAC->Channel[1].CHCTRLB.reg = DMAC_CHCTRLB_CMD_RESUME;
            DMAC->Channel[1].CHINTFLAG.bit.SUSP = 1;

            if (count)
            {
                audioCallback(_adc_buf_0, ADC_BUF_LEN);
            }
            else
            {
                audioCallback(_adc_buf_1, ADC_BUF_LEN);
            }

            count = (count + 1) % 2;
        }
    }
    ```

    เด เดเตเดกเต DMAC เดตเดฟ เดฌเดฟ เดเตป เดตเตเดฃเตเดเดฟ เดฌเดซเดฑเตเดเตพ เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเดพเตป เดชเดฑเดฏเตเด. เดกเดพเดฑเตเดฑ เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเดพเตป เดกเดพเดฑเตเดฑ เดเดฃเตเดเต เดเดจเตเดจเต เดชเดฐเดฟเดถเตเดงเดฟเดเตเดเต `audioCallback` เดฎเตเดคเตเดคเดกเต เดฌเดจเตเดงเดชเตเดชเตเดเตเด เดฌเดซเดฑเตเดเตเดชเตเดชเด เดตเดฟเดณเดฟเดเตเดเตเด.

1. `Mic mic;` เดชเตเดฐเดเตเดฏเดพเดชเดจเดคเตเดคเดฟเดจเตเดถเตเดทเด เด เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    void DMAC_1_Handler()
    {
        mic.dmaHandler();
    }
    ```

    DMAC_1_Handler DMAC เดฌเดซเดฑเตเดเตพ เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเตเดฃเตเดเดชเตเดชเตเตพ เดตเดฟเดณเดฟเดเตเดเตเด. เด เดซเดเดเตเดทเตป เดจเดพเดฎเด เดเตเดฃเตเดเต เดฎเดพเดคเตเดฐเด เดคเดฟเดฐเดฏเดชเตเดชเตเดเตเด, เดเดคเดฟเดจเดพเตฝ เดเดคเต เดจเดฟเดฒเดตเดฟเดฒเตเดฃเตเดเดพเดฏเดฟเดฐเดฟเดเตเดเดฃเด.

1. `Mic` เดเตเดฒเดพเดธเดฟเดจเตเดฑเต `public` เดธเตเดเตเดทเดจเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดฐเดฃเตเดเต เดฎเตเดคเตเดคเดกเตเดเตพ เดเตเตผเดเตเดเตเด:

    ```cpp
    void init()
    {
        analogReference(AR_INTERNAL2V23);

        _writer.init();

        initBufferHeader();
        configureDmaAdc();
    }

    void reset()
    {
        _isRecordingReady = false;
        _isRecording = false;

        _writer.reset();

        initBufferHeader();
    }
    ```

    `init` เดฎเตเดคเตเดคเดกเดฟเตฝ `Mic` เดเตเดฒเดพเดธเตเดธเต เดเตปเดทเดฟเดฏเดฒเตเดธเต เดเตเดฏเตเดฏเดพเดจเตเดณเตเดณ เดเตเดกเต เดเดฃเตเดเต. เดเดคเต เดฎเตเดเตเดเต เดชเดฟเดจเดฟเดจเตเดฑเต เดถเดฐเดฟเดฏเดพเดฏ เดตเตเตพเดเตเดเตเดเต เดธเดเตเดเดฎเดพเดเตเดเตเดฎเตเดชเตเตพ, เดซเตเดฒเดพเดทเต เดฑเตเดฑเตเดฑเตผ เดธเดเตเดเดฎเดพเดเตเดเตเดเดฏเตเด WAV เดซเดฏเตฝ เดนเตเดกเตผ เดเดดเตเดคเตเดเดฏเตเด DMAC เดเตเตบเดซเดฟเดเตผ เดเตเดฏเตเดฏเตเดเดฏเตเด เดเตเดฏเตเดฏเตเดจเตเดจเต. `reset` เดฎเตเดคเตเดคเดกเต เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดคเต เดเดชเดฏเตเดเดฟเดเตเด เดถเตเดทเด เดซเตเดฒเดพเดทเต เดฎเตเดฎเตเดฎเดฑเดฟ เดฑเตเดธเตเดฑเตเดฑเต เดเตเดฏเตเดคเต เดนเตเดกเตผ เดตเตเดฃเตเดเตเด เดเดดเตเดคเตเดจเตเดจเต.

### เดเดพเดธเตเดเต - เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเด

1. `main.cpp` เดซเดฏเดฒเดฟเตฝ `mic.h` เดนเตเดกเตผ เดซเดฏเตฝ เดเตพเดชเตเดชเตเดเตเดคเตเดคเตเด:

    ```cpp
    #include "mic.h"
    ```

1. `setup` เดซเดเดเตโเดทเดจเดฟเตฝ C เดฌเดเตเดเตบ เดเตปเดทเดฟเดฏเดฒเตเดธเต เดเตเดฏเตเดฏเตเด. เด เดฌเดเตเดเตบ เดเดฎเตผเดคเตเดคเตเดฎเตเดชเตเตพ เดเดกเดฟเดฏเต เดเดชเตเดเตผ 4 เดธเตเดเตเดเตปเดกเคธเคฎเฅเคฎ เดเดฐเดเดญเดฟเดเตเดเตเด:

    ```cpp
    pinMode(WIO_KEY_C, INPUT_PULLUP);
    ```

1. เดเดคเดฟเดจเต เดคเดพเดดเต เดฎเตเดเตเดฐเตเดซเตเตบ เดเตปเดทเดฟเดฏเดฒเตเดธเต เดเตเดฏเตเดฏเตเด, เดชเดฟเดจเตเดจเต เดเตเตบเดธเตเดณเดฟเตฝ เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดคเดฏเตเดฏเดพเดฑเดพเดฃเตเดจเตเดจเต เดชเตเดฐเดฟเดจเตเดฑเต เดเตเดฏเตเดฏเตเด:

    ```cpp
    mic.init();

    Serial.println("Ready.");
    ```

1. `loop` เดซเดเดเตโเดทเดจเดฟเดจเต เดฎเตเดเดณเดฟเตฝ เดเดชเตเดเตผ เดเตเดฏเตเดค เดเดกเดฟเดฏเต เดชเตเดฐเตเดธเดธเต เดเตเดฏเตเดฏเดพเดจเตเดณเตเดณ เดเดฐเต เดซเดเดเตเดทเตป เดจเดฟเตผเดตเดเดฟเดเตเดเตเด. เดเดชเตเดชเตเตพ เดเดคเต เดเดจเตเดจเตเด เดเตเดฏเตเดฏเดพเดฑเดฟเดฒเตเดฒ, เดชเดเตเดทเต เด เดชเดพเดเดคเตเดคเดฟเดจเตเดฑเต เดถเตเดทเด เดเดคเต เดธเตเดชเตเดเตเดเต เดเตเดเตเดธเตเดฑเตเดฑเดฟเตฝ เดฎเดพเดฑเตเดฑเดพเตป เดเดชเดฏเตเดเดฟเดเตเดเตเด:

    ```cpp
    void processAudio()
    {
    
    }
    ```

1. `loop` เดซเดเดเตโเดทเดจเดฟเตฝ เดคเดพเดดเต เดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```cpp
    void loop()
    {
        if (digitalRead(WIO_KEY_C) == LOW && !mic.isRecording())
        {
            Serial.println("Starting recording...");
            mic.startRecording();
        }
    
        if (!mic.isRecording() && mic.isRecordingReady())
        {
            Serial.println("Finished recording");
    
            processAudio();
    
            mic.reset();
        }
    }
    ```

    เด เดเตเดกเต C เดฌเดเตเดเตบ เดชเดฐเดฟเดถเตเดงเดฟเดเตเดเต เดเดฎเตผเดคเตเดคเดฟเดฏเดพเตฝ, เดฑเตเดเตเดเตเตผเดกเดฟเดเดเต เดคเตเดเดเตเดเดฟเดฏเดฟเดเตเดเดฟเดฒเตเดฒเตเดเตเดเดฟเตฝโ เดฎเดพเดคเตเดฐเด `Mic` เดเตเดฒเดพเดธเดฟเดจเตเดฑเต `_isRecording` เดซเตเตฝเดกเต true เดเดฏเดฟ เดธเดเตเดเดฎเดพเดเตเดเตเด. เดเดคเตเดตเดดเดฟ `audioCallback` เดฎเดพเดคเตเดฐเด 4 เดธเตเดเตเดเตปเดกเดฟเดจเตเดณเตเดณ เดเดกเดฟเดฏเต เดธเดเดญเดฐเดฟเดเตเดเตเด. 4 เดธเตเดเตเดเตปเดกเต เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดคเดพเตฝ `_isRecording` false เดเดฏเตเด `_isRecordingReady` true เดเดฏเตเด เดธเดเตเดเดฎเดพเดเตเด. เดเดคเต `loop` เดซเดเดเตโเดทเดจเดฟเตฝ เดชเดฐเดฟเดถเตเดงเดฟเดเตเดเต true เดเดฃเตเดเตเดเดฟเตฝ `processAudio` เดซเดเดเตเดเตเดทเตป เดตเดฟเดณเดฟเดเตเดเตเด, เดชเดฟเดจเตเดจเตเดเต เดฎเตเดเตเดเต เดเตเดฒเดพเดธเต เดฑเตเดธเตเดฑเตเดฑเต เดเตเดฏเตเดฏเตเด.

1. เด เดเตเดกเต เดฌเดฟเตฝเดกเต เดเตเดฏเตเดคเต, เดจเดฟเดเตเดเดณเตเดเต Wio เดเตเตผเดฎเดฟเดจเดฒเดฟเดฒเตเดเตเดเต เดเดชเตโเดฒเตเดกเต เดเตเดฏเตเดคเต เดธเตเดฐเดฟเดฏเตฝ เดฎเตเดฃเดฟเดฑเตเดฑเดฑเดฟเตฝ เดชเดฐเตเดเตเดทเดฟเดเตเดเตเด. C เดฌเดเตเดเตบ (เดเดเดคเตเดตเดถเดคเตเดคเตเดณเตเดณ, เดชเดตเตผ เดธเตเดตเดฟเดเตเดเต เดเดฑเตเดฑเดตเตเด เดเดเตเดคเตเดคเตเดณเตเดณเดคเต) เดเดฎเตผเดคเตเดคเดฟ เดธเดเดธเดพเดฐเดฟเดเตเดเตเด. 4 เดธเตเดเตเดเตปเดกเดฟเดจเตเดฑเต เดเดกเดฟเดฏเต เดเดชเตเดเตผ เดเตเดฏเตเดฏเตเด.

    ```output
    --- Available filters and text transformations: colorize, debug, default, direct, hexlify, log2file, nocontrol, printable, send_on_enter, time
    --- More details at http://bit.ly/pio-monitor-filters
    --- Miniterm on /dev/cu.usbmodem1101  9600,8,N,1 ---
    --- Quit: Ctrl+C | Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
    Ready.
    Starting recording...
    Finished recording
    ```

> ๐ เด เดเตเดกเต [code-record/wio-terminal](../../../../../6-consumer/lessons/1-speech-recognition/code-record/wio-terminal) เดซเตเตพเดกเดฑเดฟเตฝ เดเดฃเตเดเตเดคเตเดคเดพเด.

๐ เดจเดฟเดเตเดเดณเตเดเต เดเดกเดฟเดฏเต เดฑเตเดเตเดเตเตผเดกเดฟเดเดเต เดชเตเดฐเตเดเตเดฐเดพเด เดตเดฟเดเดฏเดฟเดเตเดเต!

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**เดเดธเตเดตเตเดเดพเดฐเตเดฏเตเดเดฐเดฃเด**:  
เด เดฐเตเด AI เดชเดฐเดฟเดญเดพเดทเดพ เดธเตเดตเดจเดฎเดพเดฏ [Co-op Translator](https://github.com/Azure/co-op-translator) เดเดชเดฏเตเดเดฟเดเตเดเต เดชเดฐเดฟเดญเดพเดท เดเตเดฏเตเดคเดคเดพเดฃเต. เดจเดพเด เดเดพเดฐเตเดฏเดเตเดทเดฎเดคเดฏเตเดเตเดเต เดถเตเดฐเดฎเดฟเดเตเดเตเดจเตเดจเดฟเดเตเดเตเดฃเตเดเตเดเตเดเดฟเดฒเตเด, เดเดเตเดเตเดฎเตเดฑเตเดฑเดกเต เดชเดฐเดฟเดญเดพเดทเดเดณเดฟเตฝ เดชเดฟเดดเดตเตเดเดณเตเด เดคเตผเดเตเดเดเตเดเดณเตเดฎเตเดฃเตเดเดพเดเดพเดฎเตเดจเตเดจเต เดฆเดฏเดตเดพเดฏเดฟ เดถเตเดฐเดฆเตเดงเดฟเดเตเดเต. เดธเตเดตเดจเตเดค เดญเดพเดทเดฏเดฟเดฒเต เดฎเตเดฒ เดฐเตเดเดฏเดพเดฃเต เดเดงเดฟเดเดพเดฐเดฎเตเดณเตเดณ เดเดฑเดตเดฟเดเด เดเดจเตเดจเต เดเดฐเตเดคเดฃเดฎเตเดจเตเดจเตเด, เดจเดฟเตผเดฃเดพเดฏเด เดตเดฟเดตเดฐเดเตเดเตพเดเตเดเดพเดฏเดฟ เดชเตเดฐเตเดซเดทเดฃเตฝ เดฎเดจเตเดทเตเดฏ เดชเดฐเดฟเดญเดพเดท เดถเตเดชเดพเตผเดถ เดเตเดฏเตเดฏเดชเตเดชเตเดเตเดจเตเดจเต. เด เดชเดฐเดฟเดญเดพเดท เดเดชเดฏเตเดเดฟเดเตเดเดคเดฟเดจเดพเตฝ เดเดฃเตเดเดพเดฏเดพเดเดพเดตเตเดจเตเดจ เดเดคเตเดเตเดเดฟเดฒเตเด เดคเตเดฑเตเดฑเต เดฎเดจเดธเตเดธเดฟเดฒเดพเดเตเดเดฒเตเดเดณเต เดฆเตเดฐเตเดญเดพเดทเตเดฏเดเตเดเดณเต เดตเดฐเตเดคเตเดคเดฟเดชเตเดชเตเดเตเดจเตเดจเดคเดฟเดจเต เดเดเตเดเตพ เดเดคเตเดคเดฐเดตเดพเดฆเดฟเดคเตเดตเด เดตเดนเดฟเดเตเดเตเดจเตเดจเดฟเดฒเตเดฒ.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->