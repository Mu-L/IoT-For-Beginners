# เดจเดฟเดเตเดเดณเตเดเต IoT เดกเดฟเดตเตเดธเต เดเตเดฒเตเดกเตเดฎเดพเดฏเดฟ เดฌเดจเตเดงเดฟเดชเตเดชเดฟเดเตเดเตเด - เดตเดฟเตผเดเตเดตเตฝ IoT เดนเดพเตผเดกเตโเดตเตเดฏเตผ เฆเฆฌเฆ เดฑเดพเดธเตโเดชเตเดฌเตเดฑเดฟ เดชเต

เดชเดพเดเดคเตเดคเดฟเดจเตเดฑเต เด เดญเดพเดเดคเตเดคเดฟเตฝ, เดจเดฟเดเตเดเตพ เดจเดฟเดเตเดเดณเตเดเต เดตเดฟเตผเดเตเดตเตฝ IoT เดกเดฟเดตเตเดธเต เดฑเดพเดธเตโเดชเตเดฌเตเดฑเดฟ เดชเตเดจเต เดจเดฟเดเตเดเดณเตเดเต IoT เดนเดฌเตเดฎเดพเดฏเดฟ เดฌเดจเตเดงเดฟเดชเตเดชเดฟเดเตเดเต เดเตเดฒเดฟเดฎเตเดเตเดฐเดฟ เดเดฏเดฏเตเดเตเดเดพเดจเตเด เดเดฎเดพเตปเดกเตเดเตพ เดธเตเดตเตเดเดฐเดฟเดเตเดเดพเดจเตเด เดชเดเดฟเดเตเดเตเด.

## เดจเดฟเดเตเดเดณเตเดเต เดกเดฟเดตเตเดธเต IoT เดนเดฌเตเดฎเดพเดฏเดฟ เดฌเดจเตเดงเดฟเดชเตเดชเดฟเดเตเดเตเด

เดเดเตเดคเตเดค เดเดเตเดเด เดจเดฟเดเตเดเดณเตเดเต เดกเดฟเดตเตเดธเดฟเดจเต IoT เดนเดฌเตเดฎเดพเดฏเดฟ เดฌเดจเตเดงเดฟเดชเตเดชเดฟเดเตเดเตเดเดฏเดพเดฃเต.

### เดเดพเดธเตโเดเต - IoT เดนเดฌเตเดฎเดพเดฏเดฟ เดฌเดจเตเดงเดฟเดชเตเดชเดฟเดเตเดเตเด

1. VS Code-เตฝ `soil-moisture-sensor` เดซเตเตพเดกเตผ เดคเตเดฑเดเตเดเตเด. เดจเดฟเดเตเดเตพ เดตเดฟเตผเดเตเดตเตฝ IoT เดกเดฟเดตเตเดธเตเดธเต เดเดชเดฏเตเดเดฟเดเตเดเตเดจเตเดจเตเดตเตเดเตเดเดฟเตฝ เดเตเตผเดฎเดฟเดจเดฒเดฟเตฝ เดตเดฟเตผเดเตเดตเตฝ เดเตปเดตเดฏเตบเดฎเตเดจเตเดฑเต เดชเตเดฐเดตเตผเดคเตเดคเดฟเดเตเดเตเดจเตเดจเดคเดพเดฏเดฟเดฐเดฟเดเตเดเดฃเด.

1. เดเดฟเดฒ เดเดงเดฟเด เดชเดฟเดชเตเดชเต เดชเดพเดเตเดเตเดเตเดเตพ เดเตปเดธเตเดฑเตเดฑเดพเตพ เดเตเดฏเตเดฏเตเด:

    ```sh
    pip3 install azure-iot-device
    ```

    `azure-iot-device` เดเดจเตเดจเดคเต เดจเดฟเดเตเดเดณเตเดเต IoT เดนเดฌเตเดฎเดพเดฏเดฟ เดธเดเดตเดฆเดฟเดเตเดเดพเตป เดเดชเดฏเตเดเดฟเดเตเดเตเดจเตเดจ เดฒเตเดฌเตเดฐเดฑเดฟเดฏเดพเดฃเต.

1. เดจเดฟเดฒเดตเดฟเดฒเตเดณเตเดณ เดเตปเดชเตเตผเดเตเดเตเดเดณเตเดเต เดคเดพเดดเต `app.py` เดซเดฏเดฒเดฟเดจเตเดฑเต เดฎเตเดเดณเดฟเตฝ เดคเดพเดดเตเดชเตเดชเดฑเดฏเตเดจเตเดจ เดเตปเดชเตเตผเดเตเดเตเดเตพ เดเตเตผเดเตเดเตเด:

    ```python
    from azure.iot.device import IoTHubDeviceClient, Message, MethodResponse
    ```

    เด เดเตเดกเต เดจเดฟเดเตเดเดณเตเดเต IoT เดนเดฌเตเดฎเดพเดฏเดฟ เดธเดเดตเดฆเดฟเดเตเดเดพเตป SDK เดเดเดชเตเตผเดเตเดเต เดเตเดฏเตเดฏเตเดจเตเดจเต.

1. `import paho.mqtt.client as mqtt` เดฒเตเตป เดจเตเดเตเดเด เดเตเดฏเตเดฏเตเด, เด เดฒเตเดฌเตเดฐเดฑเดฟ เดเดจเดฟ เดตเตเดฃเตเดเดคเดฒเตเดฒ. เดเดฒเตเดฒเดพ MQTT เดเตเดกเตเดเดณเตเด, เดเตเดชเตเดชเดฟเดเต เดจเตเดฏเดฟเดฎเตเดเดณเตเด, `mqtt_client` เดเดชเดฏเตเดเดฟเดเตเดเตเดจเตเดจ เดเตเดกเตเดเดณเตเด, `handle_command` เดเดจเตเดจเดฟเดตเดฏเตเด เดจเตเดเตเดเตเด. `while True:` เดฒเตเดชเต เดเดฃเตเดเดพเดเดเตเดเต, เดชเดเตเดทเต เด เดฒเตเดชเดฟเตฝ เดจเดฟเดจเตเดจเต `mqtt_client.publish` เดฒเตเตป เดฎเดพเดฏเตเดเตเดเตเด.

1. เดเตปเดชเตเตผเดเตเดเต เดธเตเดฑเตเดฑเตเดฑเตเดฑเตเดฎเตเดจเตเดฑเตเดเตพ เดคเดพเดดเต เดคเดพเดดเตเดฏเตเดณเตเดณ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```python
    connection_string = "<connection string>"
    ```

    `<connection string>` เดเดจเตเดจเดคเดฟเดจเตเดฑเต เดธเตเดฅเดฒเด เด เดชเดพเดเดคเตเดคเดฟเตฝ เดฎเตเดฎเตเดชเต เดจเดฟเดเตเดเตพ เดฒเดญเดฟเดเตเด เดกเดฟเดตเตเดธเต เดเตเตบเดฃเดเตเดทเตป เดธเตโเดเตเดฐเดฟเดเต เดเดชเดฏเตเดเดฟเดเตเดเตเดเตเดฃเตเดเต เดฎเดพเดฑเตเดฑเตเด.

    > ๐ เดเดคเต เดฎเดฟเดเดเตเด เดชเตเดฐเดพเดเตเดเตเดธเต เดเดฒเตเดฒ. เดเตเตบเดฃเดเตเดทเตป เดธเตโเดเตเดฐเดฟเดเดเตเดเตพ เดเดฐเดฟเดเตเดเดฒเตเด เดธเตเดดเตเดธเต เดเตเดกเดฟเตฝ เดธเดเดญเดฐเดฟเดเตเดเดฐเตเดคเต, เดเดพเดฐเดฃเด เดเดคเต เดธเตเดดเตเดธเต เดเตเดกเต เดเตบเดเตเดฐเตเดณเดฟเตฝ เดชเดฐเดฟเดถเตเดงเดฟเดเตเดเดชเตเดชเตเดเตเดเดฏเตเด เดเดฐเตเด เดเดฃเตเดเตเดชเดฟเดเดฟเดเตเดเดพเดตเตเดจเตเดจเดคเดพเดฃเต. เดเดณเตเดชเตเดชเดฎเดพเดฏเดคเดฟเดจเดพเตฝ เดเดคเดฟเดจเต เดเดตเดฟเดเต เดเตเดฏเตเดฏเตเดเดฏเดพเดฃเต. เดธเดเดเดคเดฟ เดชเดฐเดฎเดพเดตเดงเดฟ เดเดฃเตเดตเดฏเตบเดฎเตเดจเตเดฑเต เดตเตเดฑเดฟเดฏเดฌเดฟเตพ เดชเตเดฒเตเดณเตเดณ เดเดฐเต เดเดชเดพเดงเดฟ เดเดชเดฏเตเดเดฟเดเตเดเต, [`python-dotenv`](https://pypi.org/project/python-dotenv/) เดชเตเดฒเตเดฐเต เดเตเตพ เดเดชเดฏเตเดเดฟเดเตเดเต เดจเดเดคเตเดคเดพเด. เดเดคเต เดธเดเดฌเดจเตเดงเดฟเดเตเดเต เดเดเตเดคเตเดค เดชเดพเดเดคเตเดคเดฟเตฝ เดเตเดเตเดคเตฝ เดชเดเดฟเดเตเดเตเด.

1. เด เดเตเดกเดฟเดจเตเดฑเต เดคเดพเดดเต, IoT เดนเดฌเตเดฎเดพเดฏเต เดธเดเดตเดฆเดฟเดเตเดเดพเดตเตเดจเตเดจ เดเดฐเต เดกเดฟเดตเตเดธเต เดเตเดฒเดฏเดจเตเดฑเต เดเดฌเตเดเดเตเดฑเตเดฑเต เดธเตเดทเตเดเดฟเดเตเดเต เดเดคเต เดเดฃเดเตเดฑเตเดฑเต เดเตเดฏเตเดฏเดพเตป เดคเดพเดดเต เดเตเดเตเดคเตเดค เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```python
    device_client = IoTHubDeviceClient.create_from_connection_string(connection_string)

    print('Connecting')
    device_client.connect()
    print('Connected')
    ```

1. เด เดเตเดกเต เดฑเตบ เดเตเดฏเตเดฏเตเด. เดจเดฟเดเตเดเดณเตเดเต เดกเดฟเดตเตเดธเต เดเดฃเดเตเดฑเตเดฑเต เดเดเตเดจเตเดจเดคเต เดเดพเดฃเดฟเดเตเดเตเด.

    ```output
    pi@raspberrypi:~/soil-moisture-sensor $ python3 app.py 
    Connecting
    Connected
    Soil moisture: 379
    ```

## เดเตเดฒเดฟเดฎเตเดเตเดฐเดฟ เดเดฏเดเตเดเตเด

เดเดชเตเดชเตเตพ เดจเดฟเดเตเดเดณเตเดเต เดกเดฟเดตเตเดธเต เดเดฃเดเตเดฑเตเดฑเต เดเตเดฏเตเดคเดคเดฟเดจเดพเตฝ, เดจเดฟเดเตเดเตพ เดเตเดฒเดฟเดฎเตเดเตเดฐเดฟ MQTT เดฌเตเดฐเตเดเดฑเดฟเดจเต เดชเดเดฐเด IoT เดนเดฌเดฟเดฒเตเดเตเดเต เดเดฏเดเตเดเดพเตป เดเดดเดฟเดฏเตเด.

### เดเดพเดธเตโเดเต - เดเตเดฒเดฟเดฎเตเดเตเดฐเดฟ เดเดฏเดฏเตเดเตเดเตเด

1. `while True` เดฒเตเดชเดฟเดฒเตเดเตเดเต,เดธเตเดฒเตเดชเตเดชเดฟเดจเต เดฎเตเตปเดชเต เดคเดพเดดเตเดชเตเดชเดฑเดฏเตเดจเตเดจ เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```python
    message = Message(json.dumps({ 'soil_moisture': soil_moisture }))
    device_client.send_message(message)
    ```

    เด เดเตเดกเต เดเดฐเต IoT เดนเดฌเต `Message` เดธเตเดทเตเดเดฟเดเตเดเตเดจเตเดจเต, เดเดคเต JSON เดธเตเดเตเดฐเดฟเดเดเต เดฐเตเดชเดคเตเดคเดฟเตฝ เดฎเดฃเตเดฃเต เดเดณเดตเตเด เดตเดพเดฏเดฟเดเตเดเตฝ เดเตพเดเตเดเตเดณเตเดณเตเดจเตเดจเต, เดคเตเดเตผเดจเตเดจเต เดเดคเต เดกเดฟเดตเตเดธเต-เดเต-เดเตเดฒเตเดกเต เดธเดจเตเดฆเตเดถเดฎเดพเดฏเดฟ IoT เดนเดฌเดฟเดฒเตเดเตเดเต เดเดฏเดฏเตเดเตเดเตเดจเตเดจเต.

## เดเดฎเดพเตปเดกเตเดเตพ เดเตเดเดพเดฐเตเดฏเด เดเตเดฏเตเดฏเตเด

เดจเดฟเดเตเดเดณเตเดเต เดกเดฟเดตเตเดธเดฟเดจเต เดฑเตเดฏเตเดฒเต เดจเดฟเดฏเดจเตเดคเตเดฐเดฟเดเตเดเดพเตป เดธเตเตผเดตเตผ เดเตเดกเดฟเตฝ เดจเดฟเดจเตเดจเตเดณเตเดณ เดเดฎเดพเตปเดกเต เดเตเดเดพเดฐเตเดฏเด เดเตเดฏเตเดฏเดพเตป เดตเตเดฃเด. เดเดคเต เดเดฐเต เดกเตเดฐเดเตเดเต เดฎเตเคฅเดกเตเดธเต เดเดญเตเดฏเตผเดคเตเดฅเดจ เดเดฏเดฟ เดเดฏเดฏเตเดเตเดเดชเตเดชเตเดเตเดจเตเดจเต.

## เดเดพเดธเตโเดเต - เดกเตเดฐเดเตเดเต เดฎเตเดฅเดกเต เดเดญเตเดฏเตผเดคเตเดฅเดจ เดเตเดเดพเดฐเตเดฏเด เดเตเดฏเตเดฏเตเด

1. `while True` เดฒเตเดชเดฟเดจเต เดฎเตเดฎเตเดชเดพเดฏเดฟ เดคเดพเดดเต เดเตเดเตเดคเตเดค เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```python
    def handle_method_request(request):
        print("Direct method received - ", request.name)
    
        if request.name == "relay_on":
            relay.on()
        elif request.name == "relay_off":
            relay.off()    
    ```

    เดเดคเต `handle_method_request` เดเดจเตเดจ เดฎเตเดฅเดกเต เดจเดฟเตผเดตเตเดตเดเดฟเดเตเดเตเดจเตเดจเต, IoT เดนเดฌเต เดเดฐเต เดกเตเดฐเดเตเดเต เดฎเตเดฅเดกเต เดตเดฟเดณเดฟเดเตเดเตเดฎเตเดชเตเตพ เดเดคเต เดตเดฟเดณเดฟเดเตเดเดชเตเดชเตเดเตเด. เดเดฐเต เดกเตเดฐเดเตเดเต เดฎเตเดฅเดกเดฟเดจเตเดฑเตเดฏเตเด เดเดฐเต เดชเตเดฐเต เดเดฃเตเดเต, เด เดเตเดกเต `relay_on` เดเดจเตเดจ เดฎเตเดฅเดกเต เดฑเตเดฏเตโเดฒเต เดเดฃเดพเดเตเดเดพเตป, `relay_off` เดฑเตเดฏเตโเดฒเต เดเดฃเดพเดเตเดเดพเตป เดตเดฟเดณเดฟเดฏเตเดเตเดเตเด เดเดจเตเดจเต เดชเตเดฐเดคเตเดเตเดทเดฟเดเตเดเตเดจเตเดจเต.

    > ๐ เดเดคเต เดเดฐเต เดเดเดฆเตเดถเด เดกเตเดฐเดเตเดเต เดฎเตเดฅเดกเต เดเดญเตเดฏเตผเดคเตเดฅเดจเดฏเดฟเดฒเตเดเตเดฏเตเด เดจเดเดชเตเดชเดพเดเตเดเดพเดตเตเดจเตเดจเดคเดพเดฃเต, เดเดคเดฟเตฝ เดฑเตเดฏเตโเดฒเตเดฏเตเดเต เดเดตเดถเตเดฏเดฎเตเดณเตเดณ เดจเดฟเดฒ เดเดฐเต เดชเตเดฏเตโเดฒเตเดกเดฟเตฝ เดชเดพเดธเดพเดเตเดเดฟ เดฎเตเดฅเดกเต เดเดญเตเดฏเตผเดคเตเดฅเดจเดฏเตเดฎเดพเดฏเดฟ เดชเดพเดธเตเดธเดพเดเตเดเดพเดจเตเด `request` เดเดฌเตโเดเดเตเดฑเตเดฑเดฟเตฝ เดจเดฟเดจเตเดจเต เดฒเดญเดฟเดเตเดเดพเดจเตเด เดเดดเดฟเดฏเตเด.

1. เดเตเตพ เดเตเดฏเตเดฏเตเดจเตเดจ เดเตเดกเดฟเดจเต เดเตเดเดพเดฐเตเดฏเด เดเตเดฏเตเดคเดคเดพเดฏเดฟ เดชเตเดฐเดคเดฟเดเดฐเดฃเด เดจเตฝเดเดพเตป เดกเตเดฐเดเตเดเต เดฎเตเดฅเดกเตเดเตพเดเตเดเต เดชเตเดฐเดคเดฟเดเดฐเดฃเด เดเดตเดถเตเดฏเดฎเดพเดฃเต. เดเดญเตเดฏเตผเดคเตเดฅเดจเดฏเตเดเตเดเต เดชเตเดฐเดคเดฟเดเดฐเดฃเด เดธเตเดทเตเดเดฟเดเตเดเดพเตป เดคเดพเดดเต เดเตเดเตเดคเตเดค เดเตเดกเต `handle_method_request` เดซเดเตเดทเตป เดเดตเดธเดพเดจเดคเตเดคเดฟเตฝ เดเตเตผเดเตเดเตเด:

    ```python
    method_response = MethodResponse.create_from_method_request(request, 200)
    device_client.send_method_response(method_response)
    ```

    เด เดเตเดกเต เดกเตเดฐเดเตเดเต เดฎเตเดฅเดกเต เดเดญเตเดฏเตผเดคเตเดฅเดจเดฏเตเดเตเดเต HTTP เดธเตเดฑเตเดฑเดพเดฑเตเดฑเดธเต เดเตเดกเต 200 เดธเดนเดฟเดคเด เดชเตเดฐเดคเดฟเดเดฐเดฃเด เดเดฏเดเตเดเตเดจเตเดจเต, เดเดคเต IoT เดนเดฌเดฟเดฒเตเดเตเดเต เดคเดฟเดฐเดฟเดเต เดเดฏเดฏเตเดเตเดเตเดจเตเดจเต.

1. เด เดซเดเตเดทเตป เดจเดฟเตผเดตเดเดจเดคเตเดคเดฟเดจเต เดคเดพเดดเต เดคเดพเดดเต เดเตเดเตเดคเตเดค เดเตเดกเต เดเตเตผเดเตเดเตเด:

    ```python
    device_client.on_method_request_received = handle_method_request
    ```

    เดเดฐเต เดกเตเดฐเดเตเดเต เดฎเตเดฅเดกเต เดตเดฟเดณเดฟเดเตเดเตเดฎเตเดชเตเตพ IoT เดนเดฌเต เดเตเดฒเดฏเดจเตเดฑเต `handle_method_request` เดซเดเตเดทเดจเต เดตเดฟเดณเดฟเดเตเดเต เดกเดฏเดฑเดเตเดเต เดฎเตเดฅเดกเต เดเตเดเดพเดฐเตเดฏเด เดเตเดฏเตเดฏเดพเตป เด เดเตเดกเต เดธเดนเดพเดฏเดฟเดเตเดเตเดจเตเดจเต.

> ๐ เด เดเตเดกเต [code/pi](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/pi) เดเดฒเตเดฒเตเดเตเดเดฟเตฝ [code/virtual-device](../../../../../2-farm/lessons/4-migrate-your-plant-to-the-cloud/code/virtual-device) เดซเตเตพเดกเดฑเตเดเดณเดฟเตฝ เดเดฃเตเดเตเดคเตเดคเดพเดตเตเดจเตเดจเดคเดพเดฃเต.

๐ เดจเดฟเดเตเดเดณเตเดเต เดฎเดฃเตเดฃเต เดเดณเดตเตเด เดธเตเตปเดธเตผ เดชเตเดฐเตเดเตเดฐเดพเด IoT เดนเดฌเตเดฎเดพเดฏเดฟ เดเดฃเดเตเดฑเตเดฑเต เดเตเดฏเตเดคเดฟเดฐเดฟเดเตเดเตเดจเตเดจเต!

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**เดกเดฟเดธเตเดเตเดฒเตเดฎเตผ**:  
เด เดกเตเดเตเดฏเตเดฎเตเดจเตเดฑเต AI เดตเดฟเดตเตผเดคเตเดคเดจ เดธเตเดตเดจเดฎเดพเดฏ [Co-op Translator](https://github.com/Azure/co-op-translator) เดเดชเดฏเตเดเดฟเดเตเดเต เดตเดฟเดตเตผเดคเตเดคเดจเด เดเตเดฏเตเดคเดฟเดฐเดฟเดเตเดเตเดจเตเดจเต. เดเดเตเดเตพaccuracy เดเดฆเตเดฆเตเดถเดฟเดเตเดเตเดฎเตเดชเตเดดเตเด, เดธเตเดตเดฏเดฎเตเดงเดฏเดพ เดตเดฟเดตเตผเดคเตเดคเดจเดเตเดเดณเดฟเตฝ เดชเดฟเดดเดตเตเดเตพ เดเดฒเตเดฒเตเดเตเดเดฟเตฝ เดญเดพเดเดฟเดเดฎเดพเดฏ เดakurเดคเดเตพ เดเดฃเตเดเดพเดฏเดฟเดฐเดฟเดเตเดเดพเดฎเตเดจเตเดจเต เดฆเดฏเดตเดพเดฏเดฟ เดถเตเดฐเดฆเตเดงเดฟเดเตเดเตเด. เดฒเตเดเดจเดคเตเดคเดฟเดจเตเดฑเต เดฎเดพเดคเตเดญเดพเดทเดฏเดฟเดฒเต เดฏเดฅเดพเตผเดคเตเดฅ เดกเตเดเตเดฏเตเดฎเตเดจเตเดฑเต เดธเดคเตเดฏเดฎเดพเดฏ เดเดฑเดตเดฟเดเดฎเดพเดฏเดฟ เดเดฃเดเตเดเดพเดเตเดเตเดฃเตเดเดคเดพเดฃเต. เดชเตเดฐเดงเดพเดจ เดตเดฟเดตเดฐเดเตเดเตพเดเตเดเต, เดชเตเดฐเตเดซเดทเดฃเตฝ เดฎเดจเตเดทเตเดฏ เดตเดฟเดตเตผเดคเตเดคเดจเด เดถเตเดชเดพเตผเดถ เดเตเดฏเตเดฏเดชเตเดชเตเดเตเดจเตเดจเต. เด เดตเดฟเดตเตผเดคเตเดคเดจเด เดเดชเดฏเตเดเดฟเดเตเดเตเดจเตเดจเดคเดฟเดฒเตเดเต เดธเตเดทเตเดเดฟเดเตเดเตเดจเตเดจ เดฏเดพเดคเตเดฐเต เดคเตเดฑเตเดฑเดฟเดฆเตเดงเดพเดฐเดฃเดเตเดเตเด เดเดเตเดเตพ เดเดคเตเดคเดฐเดตเดพเดฆเดฟเดเดณเดฒเตเดฒ.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->